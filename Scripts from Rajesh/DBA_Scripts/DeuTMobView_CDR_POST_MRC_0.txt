/*
Step 1: Create filegroups and Database files
*/
USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201208]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201208', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201208.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201208]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201209]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201209', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201209.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201209]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201210]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201210', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201210.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201210]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201211]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201211', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201211.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201211]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201212]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201212', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201212.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201212]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201301]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201301', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201301.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201301]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201302]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201302', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201302.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201302]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201303]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201303', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201303.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201303]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201304]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201304', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201304.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201304]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201305]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201305', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201305.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201305]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201306]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201306', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201306.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201306]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201307]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201307', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201307.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201307]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201308]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201308', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201308.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201308]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201309]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201309', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201309.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201309]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201310]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201310', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201310.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201310]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201311]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201311', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201311.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201311]
GO

USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201312]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201312', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201312.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201312]
GO


USE [master]
GO
ALTER DATABASE [DeuTMobView] ADD FILEGROUP [DeuTMob_CDR_POST_MRC_201401]
GO
ALTER DATABASE [DeuTMobView] ADD FILE ( NAME = N'DeuTMob_CDR_POST_MRC_201401', FILENAME = N'T:\DB\DeuTMobView\CDR_POST_MRC_0\DeuTMob_CDR_POST_MRC_201401.ndf' , SIZE = 1024KB , FILEGROWTH = 10240KB ) TO FILEGROUP [DeuTMob_CDR_POST_MRC_201401]
GO

/*
Step 2: PARTITION FUNCTION
*/

USE [DeuTMobView]
GO
SET ANSI_PADDING ON
GO
CREATE PARTITION FUNCTION [DeuTMob_CDR_POST_MRC_FN](int) AS RANGE RIGHT FOR VALUES
(
201208,201209,201210,201211,201212,
201301,201302,201303,201304,201305,201306,201307,201308,201309,201310,201311,201312,
201401
)
SET ANSI_PADDING OFF
GO


/*
Step 3: PARTITION SCHEMA
*/

USE [DeuTMobView]
GO
SET ANSI_PADDING ON
GO
Create PARTITION SCHEME [DeuTMob_CDR_POST_MRC_SCH] AS PARTITION [DeuTMob_CDR_POST_MRC_FN] TO (
[DeuTMob_CDR_POST_MRC],
[DeuTMob_CDR_POST_MRC_201208],[DeuTMob_CDR_POST_MRC_201209],[DeuTMob_CDR_POST_MRC_201210],
[DeuTMob_CDR_POST_MRC_201211],[DeuTMob_CDR_POST_MRC_201212],
[DeuTMob_CDR_POST_MRC_201301],[DeuTMob_CDR_POST_MRC_201302],[DeuTMob_CDR_POST_MRC_201303],[DeuTMob_CDR_POST_MRC_201304],[DeuTMob_CDR_POST_MRC_201305],
[DeuTMob_CDR_POST_MRC_201306],[DeuTMob_CDR_POST_MRC_201307],[DeuTMob_CDR_POST_MRC_201308],[DeuTMob_CDR_POST_MRC_201309],[DeuTMob_CDR_POST_MRC_201310],
[DeuTMob_CDR_POST_MRC_201311],[DeuTMob_CDR_POST_MRC_201312],
[DeuTMob_CDR_POST_MRC_201401])
GO
SET ANSI_PADDING OFF
GO

--SELECT * FROM SYS.partition_functions --
----SELECT * FROM SYS.partition_parameters
--SELECT * FROM SYS.partition_range_values --
--SELECT * FROM SYS.partition_schemes --
----SELECT * FROM SYS.partitions




USE [DeuTMobView]
GO

/****** Object:  Table [dbo].[CDR2012]    Script Date: 04/24/2012 14:07:14 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_PADDING ON
GO

CREATE TABLE [dbo].[CDR_POST_MRC_0_NEW](
	[Tag] [varchar](32) NULL,
	[Standard Agreement ID] [varchar](20) NULL,
	[Contract Number] [varchar](20) NULL,
	[ICCID] [varchar](32) NULL,
	[Reference MSISDN] [varchar](32) NULL,
	[Product] [varchar](20) NULL,
	[BPR_ID] [varchar](32) NULL,
	[Product Start Date] [varchar](32) NULL,
	[Product End Date] [varchar](32) NULL,
	[Monthly recurring Charge] [float] NULL,
	[Prorated days] [bigint] NULL,
	[FileMonth] [int] NULL,
	[file_id] [int] NULL
)
ON [DeuTMob_CDR_POST_MRC_SCH] ([FileMonth])

GO

SET ANSI_PADDING OFF
GO

/*
Step 6: Create the Non clustered indexes
* Indexes and Data stored on the same filegroup -- as suggested in the best practise articles
*/

